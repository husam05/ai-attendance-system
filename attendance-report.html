<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep AI | Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <!-- Chart.js for Advanced Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .metric-box {
            text-align: center;
            padding: 2rem;
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 900;
            display: block;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 2rem 0;
        }

        .risk-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .risk-high {
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }

        .risk-medium {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }

        .risk-low {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        .student-card {
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--glass-border);
            transition: var(--transition);
        }

        .student-card:hover {
            border-left-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 100px;
            transition: width 1s ease-out;
        }

        .filter-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
    </style>
</head>

<body>
    <div class="container animate-fade-in">
        <!-- Persistent Nav -->
        <nav class="app-nav no-print">
            <div class="nav-content">
                <div style="font-weight: 900; font-size: 1.5rem; letter-spacing: -1px;">
                    <span style="color: var(--primary);">DEEP</span> AI
                </div>
                <ul class="nav-links">
                    <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="teacher-qr-scanner.html">Ø§Ù„Ù…Ø§Ø³Ø­</a></li>
                    <li><a href="attendance-management.html">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a></li>
                    <li><a href="attendance-report.html" class="active">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</a></li>
                </ul>
            </div>
        </nav>

        <!-- Print Header -->
        <div class="print-header" style="display: none;">
            <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 1rem; margin-bottom: 2rem;">
                <h1 style="color: #000; margin: 0;">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…ØµØ·ÙÙ‰ | Al-Mustafa University</h1>
                <h2 style="color: #000; margin: 10px 0;">Ù‚Ø³Ù… Ø¹Ù„ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
                <h3 style="color: #000; margin: 5px 0;">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø­Ø¶ÙˆØ±</h3>
                <p style="color: #666; margin: 5px 0;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: <span id="printDate"></span></p>
            </div>
        </div>

        <header class="header-section no-print">
            <h1 class="header-title">ğŸ“ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
            <p class="header-subtitle">Ù…Ø±ÙƒØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ Ù„Ø±ØµØ¯ ÙˆØªØ­Ù„ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨</p>
        </header>

        <!-- Advanced Metrics Dashboard -->
        <div class="stats-grid no-print" style="grid-template-columns: repeat(4, 1fr);">
            <div class="glass-card metric-box">
                <span class="metric-value" id="totalStudents">--</span>
                <span class="metric-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
            </div>
            <div class="glass-card metric-box">
                <span class="metric-value" id="avgAttendance" style="color: var(--primary);">--%</span>
                <span class="metric-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</span>
            </div>
            <div class="glass-card metric-box" style="border: 1px solid rgba(239, 68, 68, 0.3);">
                <span class="metric-value" id="atRisk" style="color: var(--danger);">--</span>
                <span class="metric-label">Ø·Ù„Ø§Ø¨ ÙÙŠ Ø®Ø·Ø±</span>
            </div>
            <div class="glass-card metric-box">
                <span class="metric-value" id="totalClasses">--</span>
                <span class="metric-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</span>
            </div>
        </div>

        <!-- Intelligent Filters -->
        <div class="glass-card no-print" style="padding: 2rem; margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1.5rem;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„ÙÙ„ØªØ±Ø©</h3>
            <div class="filter-panel">
                <div>
                    <label
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">Ù†ÙˆØ¹
                        Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                    <select id="reportType" class="form-control" onchange="updateFilters()">
                        <option value="overview">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø´Ø§Ù…Ù„Ø©</option>
                        <option value="student">ğŸ‘¤ ØªÙ‚Ø±ÙŠØ± Ø·Ø§Ù„Ø¨ ÙØ±Ø¯ÙŠ</option>
                        <option value="subject">ğŸ“š ØªØ­Ù„ÙŠÙ„ Ù…Ø§Ø¯Ø© Ø¯Ø±Ø§Ø³ÙŠØ©</option>
                        <option value="risk">âš ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                    </select>
                </div>
                <div id="studentFilter" style="display: none;">
                    <label
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">Ø§Ø®ØªØ±
                        Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                    <select id="studentSelect" class="form-control"></select>
                </div>
                <div id="subjectFilter" style="display: none;">
                    <label
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">Ø§Ø®ØªØ±
                        Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="subjectSelect" class="form-control"></select>
                </div>
                <div>
                    <label
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">Ù…Ù†
                        ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="startDate" class="form-control">
                </div>
                <div>
                    <label
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">Ø¥Ù„Ù‰
                        ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="endDate" class="form-control">
                </div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="generateReport()">ğŸ“ˆ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                <button class="btn btn-secondary" onclick="exportToExcel()">ğŸ“Š Excel ØªØµØ¯ÙŠØ±</button>
            </div>
        </div>

        <!-- Dynamic Report Container -->
        <div id="reportContent"></div>

        <!-- HOD Authentication Modal -->
        <div id="hodModal"
            style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(2,6,23,0.95); z-index:2000; align-items:center; justify-content:center; backdrop-filter:blur(20px);">
            <div class="glass-card" style="width:100%; max-width:400px; padding:3rem; text-align:center;">
                <h2 style="margin-bottom: 1rem;">ğŸ”’ Ø¯Ø®ÙˆÙ„ Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…</h2>
                <p style="color:var(--text-muted); margin-bottom: 2rem;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</p>
                <input type="password" id="hodPin" class="form-control"
                    style="text-align:center; font-size:2rem; letter-spacing:0.5rem; margin-bottom:1.5rem;"
                    placeholder="â€¢â€¢â€¢" autofocus>
                <button class="btn btn-primary" style="width:100%;" onclick="verifyPin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                <button onclick="window.location.href='index.html'" class="btn btn-secondary"
                    style="width:100%; margin-top:1rem;">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDLSX6DY_79BD8ZEYBRYh_jtmP0mHslzkE",
            authDomain: "ai-attendance-husam.firebaseapp.com",
            databaseURL: "https://ai-attendance-husam-default-rtdb.firebaseio.com",
            projectId: "ai-attendance-husam",
            storageBucket: "ai-attendance-husam.firebasestorage.app",
            messagingSenderId: "305903941972",
            appId: "1:305903941972:web:d914431aab5a1cc6b5b0c1",
            measurementId: "G-EJEKCTT2M9"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allRecords = [];
        let students = [];

        // Authentication
        function checkAuth() {
            if (sessionStorage.getItem('hod_auth') !== 'true') {
                document.getElementById('hodModal').style.display = 'flex';
            } else {
                initDashboard();
            }
        }

        function verifyPin() {
            if (document.getElementById('hodPin').value === '987987987') {
                sessionStorage.setItem('hod_auth', 'true');
                document.getElementById('hodModal').style.display = 'none';
                initDashboard();
            } else {
                alert('Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­');
            }
        }

        // Dashboard Initialization
        async function initDashboard() {
            document.getElementById('printDate').textContent = new Date().toLocaleDateString('ar-EG');
            setDefaultDates();
            await loadStudents();
            await loadRecords();
            populateFilters();
            generateReport();
        }

        async function loadStudents() {
            // Try Firebase first
            const snap = await db.ref('students_list').once('value');
            if (snap.exists()) {
                students = snap.val();
            } else {
                // Fallback to local
                students = [
                    "ÙŠÙˆØ³Ù Ù…ÙŠØ«Ø§Ù‚ Ø·Ø§Ù„Ø¨ Ø¹Ø¬ÙŠÙ„", "Ø­Ø³ÙŠÙ† Ø¹Ù„ÙŠ Ø¯ÙˆØ´Ø§Ù† ÙƒØ§Ø¸Ù…", "Ù†ÙˆØ±Ø§Ù„Ø­Ø³Ù† Ø¨Ø§Ø³Ù… Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø²Ø§Ù‚ Ø­Ø³ÙŠÙ†",
                    "Ù…ØµØ·ÙÙ‰ ÙØ¤Ø§Ø¯ ÙØ§Ø¶Ù„ Ø¹Ø¨Ø¯ Ø§Ù„Ø§Ù…ÙŠØ±", "Ø¹Ù„ÙŠ Ø¬Ù…Ø§Ù„ Ø®Ù„Ù ÙØ¹ÙŠÙ„", "Ù…ØµØ·ÙÙ‰ Ù…Ø­Ù…Ø¯ Ù…Ø±Ø¯Ø§Ù† Ø­Ø³Ù†",
                    "Ø¶Ø­Ù‰ Ø­ÙŠØ¯Ø± ÙƒÙ…Ø§Ù„ Ø¬ÙˆØ¯Ù‡", "Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ø¬Ø¨Ø§Ø± Ø­Ø³ÙŠÙ†", "Ø¨Ù†ÙŠÙ† Ø¯ÙŠØ§Ø± Ø±Ø­ÙŠÙ… ØµÙØ±",
                    "Ø²Ù‡Ø±Ø§Ø¡ Ù…Ø­Ù…Ø¯ Ø³Ø±ÙŠØ­ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø³Ù†", "Ø²Ù‡Ø±Ø§Ø¡ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ù‡Ø¯ÙŠ Ø®Ø¶ÙŠØ±", "Ù…Ù†ØªØ¸Ø± Ø­Ù…ÙŠØ¯ Ø¹Ø°Ø§Ø¨ Ø¶Ø§Ø­ÙŠ",
                    "Ù†Ø¨Ø£ Ø¬Ø§Ø³Ù… Ø±Ø­Ù…Ù‡ Ø´Ø§ÙŠØ¹", "Ù…Ø¹ØµÙˆÙ…Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø³ÙŠÙ† Ø¬Ø¨Ø§Ø± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡", "Ø¯Ø§Ù„ÙŠØ§ ÙƒØ±ÙŠÙ… Ù„ÙŠÙ„Ùˆ Ù…Ù†ØµÙˆØ±",
                    "Ù…Ø¤Ù…Ù„ Ø³Ø¹Ø¯ÙˆÙ† Ø¬Ø¨Ø§Ø± Ù„ÙØªÙ‡", "Ø³Ø¨Ø£ Ù…Ø­Ù…Ø¯ ØµØ¨Ø±ÙŠ Ø³Ù„Ø·Ø§Ù†", "Ø±Ù‚ÙŠÙ‡ Ø§Ø«ÙŠØ± Ø§Ø­Ù…Ø¯ Ù…Ø·Ù„Ù‚", "ÙƒØ§Ø¸Ù… Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø³Ù…"
                ];
            }
        }

        async function loadRecords() {
            const snap = await db.ref('attendanceRecords').once('value');
            allRecords = [];
            snap.forEach(child => {
                allRecords.push(child.val());
            });
        }

        function populateFilters() {
            const studentSel = document.getElementById('studentSelect');
            studentSel.innerHTML = students.map(s => `<option value="${s}">${s}</option>`).join('');

            const subjects = [...new Set(allRecords.map(r => r.subject))];
            const subjectSel = document.getElementById('subjectSelect');
            subjectSel.innerHTML = subjects.map(s => `<option value="${s}">${s}</option>`).join('');
        }

        function updateFilters() {
            const type = document.getElementById('reportType').value;
            document.getElementById('studentFilter').style.display = type === 'student' ? 'block' : 'none';
            document.getElementById('subjectFilter').style.display = type === 'subject' ? 'block' : 'none';
        }

        function setDefaultDates() {
            const today = new Date();
            const threeMonthsAgo = new Date(today);
            threeMonthsAgo.setMonth(today.getMonth() - 3);
            document.getElementById('startDate').valueAsDate = threeMonthsAgo;
            document.getElementById('endDate').valueAsDate = today;
        }

        function filterByDate(records) {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            return records.filter(r => (!start || r.date >= start) && (!end || r.date <= end));
        }

        // Report Generation Logic
        function generateReport() {
            const type = document.getElementById('reportType').value;
            const filtered = filterByDate(allRecords);

            if (type === 'overview') generateOverviewReport(filtered);
            else if (type === 'student') generateStudentReport(filtered);
            else if (type === 'subject') generateSubjectReport(filtered);
            else if (type === 'risk') generateRiskReport(filtered);
        }

        function generateOverviewReport(records) {
            const dates = [...new Set(records.map(r => r.date))];
            const totalClasses = dates.length;

            // Calculate student stats
            const stats = students.map(student => {
                const attended = records.filter(r => r.studentName === student).length;
                const percentage = totalClasses > 0 ? Math.round((attended / totalClasses) * 100) : 0;
                return { name: student, attended, total: totalClasses, percentage };
            });

            const avgAttendance = stats.reduce((sum, s) => sum + s.percentage, 0) / students.length;
            const atRisk = stats.filter(s => s.percentage < 75).length;

            // Update metrics
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('avgAttendance').textContent = Math.round(avgAttendance) + '%';
            document.getElementById('atRisk').textContent = atRisk;
            document.getElementById('totalClasses').textContent = totalClasses;

            // Generate report HTML
            document.getElementById('reportContent').innerHTML = `
                <div class="glass-card" style="padding: 2.5rem; margin-bottom: 2rem;">
                    <h2 style="margin-bottom: 2rem;">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                    
                    <div class="chart-container no-print">
                        <canvas id="overviewChart"></canvas>
                    </div>

                    <div class="table-container" style="margin-top: 2rem;">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                    <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                    <th>Ø§Ù„Ù…Ø¤Ø´Ø±</th>
                                    <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${stats.map((s, i) => {
                const riskClass = s.percentage >= 90 ? 'low' : s.percentage >= 75 ? 'medium' : 'high';
                const badge = s.percentage >= 90 ? 'success' : s.percentage >= 75 ? 'badge' : 'danger';
                const rating = s.percentage >= 90 ? 'Ù…Ù…ØªØ§Ø²' : s.percentage >= 75 ? 'Ø¬ÙŠØ¯' : s.percentage >= 60 ? 'Ù…Ù‚Ø¨ÙˆÙ„' : 'Ø¶Ø¹ÙŠÙ';
                return `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td style="font-weight: 700;">${s.name}</td>
                                            <td>${s.attended}</td>
                                            <td>${s.total}</td>
                                            <td style="font-weight: 900; font-size: 1.1rem;">${s.percentage}%</td>
                                            <td><span class="risk-indicator risk-${riskClass}"></span></td>
                                            <td><span class="badge badge-${badge}">${rating}</span></td>
                                        </tr>
                                    `;
            }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Create chart
            setTimeout(() => {
                const ctx = document.getElementById('overviewChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: stats.map(s => s.name.split(' ')[0]),
                        datasets: [{
                            label: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± (%)',
                            data: stats.map(s => s.percentage),
                            backgroundColor: stats.map(s =>
                                s.percentage >= 90 ? 'rgba(16, 185, 129, 0.7)' :
                                    s.percentage >= 75 ? 'rgba(245, 158, 11, 0.7)' :
                                        'rgba(239, 68, 68, 0.7)'
                            ),
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true, max: 100 } }
                    }
                });
            }, 100);
        }

        function generateRiskReport(records) {
            const dates = [...new Set(records.map(r => r.date))];
            const totalClasses = dates.length;

            const stats = students.map(student => {
                const attended = records.filter(r => r.studentName === student).length;
                const percentage = totalClasses > 0 ? Math.round((attended / totalClasses) * 100) : 0;
                return { name: student, attended, total: totalClasses, percentage };
            }).filter(s => s.percentage < 75).sort((a, b) => a.percentage - b.percentage);

            document.getElementById('reportContent').innerHTML = `
                <div class="glass-card" style="padding: 2.5rem;">
                    <h2 style="margin-bottom: 2rem; color: var(--danger);">âš ï¸ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</h2>
                    <p style="color: var(--text-muted); margin-bottom: 2rem;">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ø§Ø¬Ù„Ø© (Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø£Ù‚Ù„ Ù…Ù† 75%)</p>
                    
                    ${stats.length === 0 ? '<div style="text-align:center; padding:3rem; color:var(--success);"><h3>âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø­Ø§Ù„Ø© Ø¬ÙŠØ¯Ø©!</h3></div>' :
                    stats.map(s => `
                        <div class="glass-card student-card" style="border-left-color: var(--danger);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="margin-bottom: 0.5rem;">${s.name}</h4>
                                    <p style="color: var(--text-muted); font-size: 0.9rem;">Ø­Ø¶Ø± ${s.attended} Ù…Ù† ${s.total} Ù…Ø­Ø§Ø¶Ø±Ø©</p>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2.5rem; font-weight: 900; color: var(--danger);">${s.percentage}%</div>
                                    <div class="badge badge-danger">ÙŠØªØ·Ù„Ø¨ ØªØ¯Ø®Ù„</div>
                                </div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill" style="width: ${s.percentage}%; background: linear-gradient(90deg, var(--danger), var(--warning));"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateStudentReport(records) {
            const studentName = document.getElementById('studentSelect').value;
            const studentRecords = records.filter(r => r.studentName === studentName);
            const dates = [...new Set(records.map(r => r.date))];
            const percentage = dates.length > 0 ? Math.round((studentRecords.length / dates.length) * 100) : 0;

            document.getElementById('reportContent').innerHTML = `
                <div class="glass-card" style="padding: 2.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 2rem; border-bottom: 1px solid var(--glass-border);">
                        <div>
                            <h2>${studentName}</h2>
                            <p style="color: var(--text-muted);">ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ù„Ù„Ø·Ø§Ù„Ø¨</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; font-weight: 900; color: var(--primary);">${percentage}%</div>
                            <div class="badge ${percentage >= 90 ? 'badge-success' : percentage >= 75 ? 'badge' : 'badge-danger'}">
                                ${percentage >= 90 ? 'Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²' : percentage >= 75 ? 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</th>
                                    <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${studentRecords.reverse().map(r => `
                                    <tr>
                                        <td>${r.date}</td>
                                        <td><span class="badge" style="background:rgba(99,102,241,0.1); color:var(--primary);">${r.subject}</span></td>
                                        <td>${r.lectureType}</td>
                                        <td>${r.time}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateSubjectReport(records) {
            const subject = document.getElementById('subjectSelect').value;
            const subjectRecords = records.filter(r => r.subject === subject);
            const dates = [...new Set(subjectRecords.map(r => r.date))];

            const stats = students.map(student => {
                const attended = subjectRecords.filter(r => r.studentName === student).length;
                const percentage = dates.length > 0 ? Math.round((attended / dates.length) * 100) : 0;
                return { name: student, attended, total: dates.length, percentage };
            });

            const avgAttendance = stats.reduce((sum, s) => sum + s.percentage, 0) / students.length;

            document.getElementById('reportContent').innerHTML = `
                <div class="glass-card" style="padding: 2.5rem;">
                    <h2 style="margin-bottom: 2rem;">ğŸ“š ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ø¯Ø©: ${subject}</h2>
                    <div style="text-align: center; padding: 2rem; background: rgba(99,102,241,0.1); border-radius: 16px; margin-bottom: 2rem;">
                        <div style="font-size: 3rem; font-weight: 900; color: var(--primary);">${Math.round(avgAttendance)}%</div>
                        <div style="color: var(--text-muted);">Ù…ØªÙˆØ³Ø· Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø§Ø¯Ø© | ${dates.length} Ù…Ø­Ø§Ø¶Ø±Ø©</div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                    <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                    <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${stats.map(s => `
                                    <tr>
                                        <td style="font-weight: 700;">${s.name}</td>
                                        <td>${s.attended}</td>
                                        <td>${s.total}</td>
                                        <td style="font-weight: 900;">${s.percentage}%</td>
                                        <td><span class="badge ${s.percentage >= 90 ? 'badge-success' : s.percentage >= 75 ? 'badge' : 'badge-danger'}">
                                            ${s.percentage >= 90 ? 'Ù…Ù…ØªØ§Ø²' : s.percentage >= 75 ? 'Ø¬ÙŠØ¯' : 'Ø¶Ø¹ÙŠÙ'}
                                        </span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function exportToExcel() {
            alert('Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        // Initialize
        checkAuth();
    </script>
</body>

</html>